<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bestelling Bevestigd / Commande Confirm√©e</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f4c3a 0%, #1a5d4a 50%, #0d3d2f 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 50px;
            text-align: center;
        }

        .status-icon {
            font-size: 80px;
            margin-bottom: 30px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        h1 {
            color: #0f4c3a;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .message {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .order-info {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: left;
            border-left: 4px solid #228B22;
        }

        .order-info h3 {
            color: #0f4c3a;
            margin-bottom: 15px;
            text-align: center;
        }

        .order-info p {
            color: #333;
            margin: 10px 0;
        }

        .order-info strong {
            color: #0f4c3a;
        }

        .btn {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(34, 139, 34, 0.4);
        }

        .loading {
            color: #228B22;
            font-size: 1.2rem;
            margin: 20px 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid rgba(34, 139, 34, 0.3);
            border-radius: 50%;
            border-top-color: #228B22;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .footer-logo {
            margin-top: 40px;
            opacity: 0.7;
        }

        .footer-logo img {
            max-width: 80px;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container" id="statusContainer">
        <div class="loading-spinner"></div>
        <div class="loading">Bestelling verwerken... üîÑ<br>Traitement de la commande...</div>
    </div>

    <!-- Hidden iframe for form submission -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

    <script>
        // Your Google Form URL (the formResponse URL)
        const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLScIGSrCx53X3yTJIrydkwQL8AkFHOMRkrwo2c5FtNz2seK9SQ/formResponse';
        
        const translations = {
            nl: {
                success_title: 'Betaling Geslaagd!',
                success_message: 'Hartelijk dank voor je bestelling! Je betaling is succesvol verwerkt.',
                email_message: 'Je ontvangt binnen enkele minuten een bevestigingsmail met alle details. Controleer u spam folder!',
                order_details: 'Bestelling Details',
                order_number: 'Bestelnummer:',
                name: 'Naam:',
                email: 'Email:',
                quantity: 'Aantal kerstbomen:',
                total: 'Totaal bedrag:',
                new_order: 'üéÑ Nieuwe bestelling plaatsen',
                processing: 'Bestelling verwerken...',
                error_title: 'Er ging iets mis',
                error_message: 'We konden je bestelling niet voltooien.',
                retry: 'üîÑ Opnieuw Proberen'
            },
            fr: {
                success_title: 'Paiement R√©ussi!',
                success_message: 'Merci beaucoup pour votre commande! Votre paiement a √©t√© trait√© avec succ√®s.',
                email_message: 'Vous recevrez un email de confirmation avec tous les d√©tails dans quelques minutes. V√©rifiez votre spam!',
                order_details: 'D√©tails de la commande',
                order_number: 'Num√©ro de commande:',
                name: 'Nom:',
                email: 'Email:',
                quantity: 'Nombre de sapins:',
                total: 'Montant total:',
                new_order: 'üéÑ Passer une nouvelle commande',
                processing: 'Traitement de la commande...',
                error_title: 'Quelque chose s\'est mal pass√©',
                error_message: 'Nous n\'avons pas pu finaliser votre commande.',
                retry: 'üîÑ R√©essayer'
            }
        };

        function submitToGoogleForm(orderData) {
            console.log('Submitting order to Google Form:', orderData);

            // Create a form dynamically
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = GOOGLE_FORM_URL;
            form.target = 'hidden_iframe';

            // Add all the form fields
            const fields = {
                'entry.2047649140': orderData.name,
                'entry.236342541': orderData.email,
                'entry.1872094456': orderData.phone,
                'entry.940252222': orderData.quantity.toString(),
                'entry.204874220': '‚Ç¨' + orderData.totalPrice,
                'entry.157753956': orderData.orderNumber,
                'entry.1997491153': orderData.needsInvoice ? 'Yes' : 'No',
                'entry.927105195': orderData.language.toUpperCase(),
                'entry.790720897': orderData.paymentId || ''
            };

            // Add company details if invoice needed
            if (orderData.needsInvoice) {
                fields['entry.195252341'] = orderData.companyName || '';
                fields['entry.26035493'] = orderData.vatNumber || '';
                fields['entry.1560784429'] = orderData.address || '';
                fields['entry.1447391829'] = orderData.city || '';
                fields['entry.841053905'] = orderData.postalCode || '';
            }

            // Create hidden input fields
            Object.keys(fields).forEach(key => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = fields[key];
                form.appendChild(input);
            });

            // Append form to body and submit
            document.body.appendChild(form);
            form.submit();

            console.log('Form submitted successfully');

            // Show success immediately (form submission happens in background)
            setTimeout(() => {
                showSuccess(orderData, orderData.language);
                // Clean up
                localStorage.removeItem('pendingOrder');
                localStorage.removeItem('orderLanguage');
                document.body.removeChild(form);
            }, 1000);
        }

        function processOrder() {
            try {
                // Get stored order data
                const orderDataStr = localStorage.getItem('pendingOrder');
                const lang = localStorage.getItem('orderLanguage') || 'nl';

                console.log('Retrieved order data:', orderDataStr);

                if (!orderDataStr) {
                    showError('Geen bestellingsgegevens gevonden / Aucune donn√©e de commande trouv√©e', lang);
                    return;
                }

                const orderData = JSON.parse(orderDataStr);
                console.log('Parsed order data:', orderData);

                // Check if we have payment ID
                if (!orderData.paymentId) {
                    showError('Geen betalings-ID gevonden / Aucun ID de paiement trouv√©', lang);
                    return;
                }

                // Submit to Google Form
                submitToGoogleForm(orderData);

            } catch (error) {
                console.error('Error processing order:', error);
                const lang = localStorage.getItem('orderLanguage') || 'nl';
                showError(error.message, lang);
            }
        }

        function showSuccess(orderData, lang) {
            const t = translations[lang];
            
            document.getElementById('statusContainer').innerHTML = `
                <div class="status-icon">‚úÖ</div>
                <h1>${t.success_title}</h1>
                <p class="message">${t.success_message}</p>
                <p class="message">${t.email_message}</p>
                
                <div class="order-info">
                    <h3>${t.order_details}</h3>
                    <p><strong>${t.order_number}</strong> ${orderData.orderNumber}</p>
                    <p><strong>${t.name}</strong> ${orderData.name}</p>
                    <p><strong>${t.email}</strong> ${orderData.email}</p>
                    <p><strong>${t.quantity}</strong> ${orderData.quantity}</p>
                    <p><strong>${t.total}</strong> ‚Ç¨${orderData.totalPrice}</p>
                </div>

                <a href="index.html" class="btn">${t.new_order}</a>

                <div class="footer-logo">
                    <img src="https://i.ibb.co/Dn8q54B/cropped-logortbround-1.png" alt="RT2 Logo">
                </div>
            `;
        }

        function showError(message, lang = 'nl') {
            const t = translations[lang];
            
            document.getElementById('statusContainer').innerHTML = `
                <div class="status-icon">‚ö†Ô∏è</div>
                <h1>${t.error_title}</h1>
                <div class="error-box">
                    <p>${t.error_message}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">${message}</p>
                </div>
                <a href="index.html" class="btn">${t.retry}</a>
            `;
        }

        // Start processing when page loads
        window.addEventListener('DOMContentLoaded', processOrder);
    </script>
</body>
</html>
